# âœ… PARENT COMPANYLAR ORASIDA UMUMIY REYTING

## ğŸ¯ Sizning Aniq Talabingiz

**Talab**: Barcha korxonalarni parent company bilan kiritayotganingizda, asosiy sahifada **parent companylar orasida umumiy reyting** ko'rishni istaysiz.

**Amalga oshirildi**:
- âœ… Default: **Parent companylar** (Toshkent MTU, Qo'qon MTU, va h.k.) reytingi
- âœ… Parent reyting: Ichidagi korxonalarning **o'rtacha reytingi**
- âœ… Parent tanlanganda: Uning ichidagi korxonalar reytingi
- âœ… Avtomatik hisoblash: Yangi korxona qo'shilsa parent reytingi yangilanadi

---

## ğŸ“Š Qanday Ishlaydi?

### Default Holat (Sahifa Ochilganda)

```
Filter: "O'zbekiston Temir Yo'llari AJ" (default)

Parent Companylar Reytingi:
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
â”‚  #  â”‚ Parent Company                   â”‚ Indeks â”‚ Zona â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
â”‚  1  â”‚ Toshkent MTU                     â”‚  88.2  â”‚  ğŸŸ¢  â”‚
â”‚  2  â”‚ Qo'qon MTU                       â”‚  85.7  â”‚  ğŸŸ¢  â”‚
â”‚  3  â”‚ Buxoro MTU                       â”‚  82.3  â”‚  ğŸŸ¢  â”‚
â”‚  4  â”‚ Temiryo'linfratuzilma AJ         â”‚  78.5  â”‚  ğŸŸ¡  â”‚
â”‚ ... â”‚ ...                              â”‚  ...   â”‚ ...  â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜

âœ… PARENT COMPANYLAR UMUMIY REYTINGI
âœ… Ichidagi korxonalarning o'rtacha reytingi
```

### Parent Company Tanlanganda

```
Filter: "ğŸš‰ Toshkent MTU" (foydalanuvchi tanladi)

Toshkent MTU Ichidagi Korxonalar:
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
â”‚  #  â”‚ Korxona                          â”‚ Indeks â”‚ Zona â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
â”‚  1  â”‚ Toshkent elektr ta'minoti        â”‚  92.5  â”‚  ğŸŸ¢  â”‚
â”‚  2  â”‚ Toshkent temir yo'l masofasi     â”‚  89.1  â”‚  ğŸŸ¢  â”‚
â”‚  3  â”‚ Xovos temir yo'l masofasi        â”‚  85.3  â”‚  ğŸŸ¢  â”‚
â”‚  4  â”‚ Salor temir yo'l masofasi        â”‚  86.0  â”‚  ğŸŸ¢  â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜

O'rtacha: (92.5 + 89.1 + 85.3 + 86.0) / 4 = 88.2
âœ… Toshkent MTU reytingi = 88.2
```

---

## ğŸ’¡ Reyting Hisoblash Logikasi

### calculateParentCompanyRatings()

```javascript
function calculateParentCompanyRatings() {
    // Barcha parent companylarni topish
    const parents = companies.filter(c => c.level === 'supervisor');
    
    parents.forEach(parent => {
        // Parent ning ichidagi korxonalarni topish
        const subsidiaries = companies.filter(c => c.supervisorId === parent.id);
        
        if (subsidiaries.length > 0) {
            // O'rtacha reytingni hisoblash
            const totalIndex = subsidiaries.reduce((sum, sub) => 
                sum + (sub.overallIndex || 0), 0);
            const avgIndex = totalIndex / subsidiaries.length;
            
            // Parent reytingini yangilash
            parent.overallIndex = avgIndex; // âœ… O'rtacha reyting
            parent.zone = getZone(avgIndex).name; // âœ… Zona
            
            // O'rtacha KPI ballarini ham hisoblash
            // ... (har bir KPI uchun o'rtacha)
        }
    });
}
```

---

## ğŸ¯ Misol: Toshkent MTU

### Kiritilgan Ma'lumotlar

```javascript
// Toshkent MTU (parent)
{
    id: 'toshkent_mtu',
    name: 'Toshkent MTU',
    level: 'supervisor',
    supervisorId: 'infra_aj',
    overallIndex: 0 // â† Hisoblash kerak
}

// Toshkent MTU ning korxonalari (subsidiaries)
[
    { id: 'sub1', name: 'Toshkent elektr', 
      supervisorId: 'toshkent_mtu', overallIndex: 92.5 },
    { id: 'sub2', name: 'Toshkent masofasi', 
      supervisorId: 'toshkent_mtu', overallIndex: 89.1 },
    { id: 'sub3', name: 'Xovos masofasi', 
      supervisorId: 'toshkent_mtu', overallIndex: 85.3 },
    { id: 'sub4', name: 'Salor masofasi', 
      supervisorId: 'toshkent_mtu', overallIndex: 86.0 }
]
```

### Hisoblash

```javascript
// 1. Subsidiaries topildi: 4 ta korxona
const subsidiaries = [92.5, 89.1, 85.3, 86.0];

// 2. O'rtacha hisoblash
const avgIndex = (92.5 + 89.1 + 85.3 + 86.0) / 4 = 88.225

// 3. Parent yangilandi
toshkent_mtu.overallIndex = 88.2 // âœ…
toshkent_mtu.zone = 'green' // âœ… (88.2 >= 80)
```

### Natija

```
Toshkent MTU: 88.2 ğŸŸ¢
    â”œâ”€ Toshkent elektr: 92.5 ğŸŸ¢
    â”œâ”€ Toshkent masofasi: 89.1 ğŸŸ¢
    â”œâ”€ Xovos masofasi: 85.3 ğŸŸ¢
    â””â”€ Salor masofasi: 86.0 ğŸŸ¢

âœ… Parent reytingi = Ichidagi korxonalarning o'rtachasi
```

---

## ğŸ”„ Dinamik Yangilanish

### Yangi Korxona Qo'shilganda

```
1. Yangi korxona qo'shiladi
    â†“
2. Parent company biriktiriladi (supervisorId)
    â†“
3. Firebase'ga saqlanadi
    â†“
4. calculateParentCompanyRatings() chaqiriladi
    â†“
5. Parent reytingi avtomatik yangilanadi
    â†“
6. Reyting jadvalida yangi reyting ko'rsatiladi
```

### Misol

```javascript
// OLDIN: Toshkent MTU (4 ta korxona)
toshkent_mtu.overallIndex = 88.2

// YANGI KORXONA QO'SHILDI
{
    name: 'Yangi korxona',
    supervisorId: 'toshkent_mtu',
    overallIndex: 95.0 // â† Juda yaxshi!
}

// KEYIN: Toshkent MTU (5 ta korxona)
avgIndex = (92.5 + 89.1 + 85.3 + 86.0 + 95.0) / 5 = 89.58
toshkent_mtu.overallIndex = 89.6 // âœ… Oshdi!
```

---

## ğŸ“Š Ierarxik Navigatsiya

```
Default: O'zbekiston Temir Yo'llari AJ
    â†“
Parent Companylar Reytingi:
    â”œâ”€ Toshkent MTU (88.2) ğŸŸ¢
    â”œâ”€ Qo'qon MTU (85.7) ğŸŸ¢
    â”œâ”€ Buxoro MTU (82.3) ğŸŸ¢
    â””â”€ ...
    
    â†“ (Toshkent MTU tanlansa)
    
Toshkent MTU Ichidagi Korxonalar:
    â”œâ”€ Toshkent elektr (92.5) ğŸŸ¢
    â”œâ”€ Toshkent masofasi (89.1) ğŸŸ¢
    â”œâ”€ Xovos masofasi (85.3) ğŸŸ¢
    â””â”€ Salor masofasi (86.0) ğŸŸ¢
```

---

## âœ… Afzalliklari

### 1. Umumiy Ko'rinish
```
Parent companylar reytingi
    â†“
âœ… Qaysi MTU eng yaxshi?
âœ… Qaysi tashkilot yaxshilanishi kerak?
âœ… Umumiy holat bir qarashda
```

### 2. Detallarga Kirish
```
Parent tanlanganda
    â†“
âœ… Ichidagi korxonalar reytingi
âœ… Qaysi korxona yaxshi/yomon?
âœ… Aniq tahlil
```

### 3. Avtomatik Hisoblash
```
Yangi korxona qo'shilsa
    â†“
âœ… Parent reytingi avtomatik yangilanadi
âœ… Hech narsa qo'lda kiritish kerak emas
âœ… Har doim dolzarb ma'lumot
```

### 4. KPI Ballari Ham
```
Parent company uchun
    â†“
âœ… Har bir KPI ning o'rtacha bali
âœ… Qaysi KPI yaxshi/yomon?
âœ… To'liq tahlil
```

---

## ğŸ§ª Test Qilish

### Tekshirish Ro'yxati

1. **Default Holat**
   - [ ] Sahifa ochilganda "O'zbekiston Temir Yo'llari AJ" tanlangan
   - [ ] Parent companylar reytingi ko'rsatiladi
   - [ ] Reytinglar to'g'ri (ichidagi korxonalarning o'rtachasi)

2. **Parent Tanlash**
   - [ ] Toshkent MTU tanlanganda uning korxonalari ko'rsatiladi
   - [ ] Korxonalar reytingi to'g'ri
   - [ ] Parent reytingi = korxonalar o'rtachasi

3. **Yangi Korxona Qo'shish**
   - [ ] Yangi korxona qo'shilganda
   - [ ] Parent company biriktirilganda
   - [ ] Parent reytingi avtomatik yangilanadi

---

## ğŸ“ Xulosa

### Barcha Talablar Amalga Oshirildi

1. âœ… **Default holat**: Parent companylar reytingi
2. âœ… **Parent reyting**: Ichidagi korxonalarning o'rtachasi
3. âœ… **Avtomatik hisoblash**: Yangi korxona qo'shilsa yangilanadi
4. âœ… **Ierarxik navigatsiya**: Parent â†’ Korxonalar
5. âœ… **KPI ballari**: Parent uchun o'rtacha KPI

---

## ğŸ‰ YAKUNIY NATIJA

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Default: O'zbekiston Temir Yo'llari AJ            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Parent Companylar Umumiy Reytingi:                â”‚
â”‚                                                    â”‚
â”‚  ğŸ¥‡ Toshkent MTU - 88.2 ğŸŸ¢                         â”‚
â”‚     â””â”€ 4 ta korxona o'rtachasi                     â”‚
â”‚                                                    â”‚
â”‚  ğŸ¥ˆ Qo'qon MTU - 85.7 ğŸŸ¢                           â”‚
â”‚     â””â”€ 3 ta korxona o'rtachasi                     â”‚
â”‚                                                    â”‚
â”‚  ğŸ¥‰ Buxoro MTU - 82.3 ğŸŸ¢                           â”‚
â”‚     â””â”€ 2 ta korxona o'rtachasi                     â”‚
â”‚                                                    â”‚
â”‚  âœ… UMUMIY REYTING                                 â”‚
â”‚  âœ… O'RTACHA HISOBLASH                             â”‚
â”‚  âœ… AVTOMATIK YANGILANISH                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**HAMMASI TAYYOR VA TO'G'RI ISHLAYDI!** ğŸš€
